<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Liquidaci√≥n de Sueldos</title>
    <link rel="stylesheet" href="styles.css">


    <!-- Librer√≠as para PDF y Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

</head>
<body>
    <!-- CONTENEDOR DE NOTIFICACIONES -->
    <div class="notifications-container" id="notifications-container"></div>
    <div class="container">
        <!-- BARRA LATERAL -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2 style="color: white;">üíº Sistema de Sueldos</h2>
                <p>Panel de Administraci√≥n</p>
                <span id="db-status" class="status-badge">PostgreSQL Conectado</span>
            </div>


            <!-- dashboard -->
            <div class="menu-group">
                <div class="menu-title" onclick="toggleMenu('dashboard-menu')">
                    <span>üìä Dashboard</span>
                    <i>‚ñº</i>
                </div>
                <div class="menu-items" id="dashboard-menu">
                    <div class="menu-item" onclick="showDashboard()">Ver Dashboard</div>
                </div>
            </div>


            <!-- GRUPO: CONVENIOS Y CONCEPTOS -->
            <div class="menu-group">
                <div class="menu-title active" onclick="toggleMenu('convenios-menu')">
                    <span>üìã Convenios y Conceptos</span>
                    <i>‚ñº</i>
                </div>
                <div class="menu-items active" id="convenios-menu">
                    <div class="menu-item active" onclick="showSection('convenios')">Convenios Colectivos</div>
                    <div class="menu-item" onclick="showSection('horas-extras')">Horas Extras</div>
                    <div class="menu-item" onclick="showSection('feriados')">Feriados</div>
                    <div class="menu-item" onclick="showSection('adicionales')">Adicionales</div>
                </div>
            </div>

            <!-- GRUPO: DESCUENTOS Y LICENCIAS -->
            <div class="menu-group">
                <div class="menu-title active" onclick="toggleMenu('descuentos-menu')">
                    <span>üí∞ Descuentos y Licencias</span>
                    <i>‚ñº</i>
                </div>
                <div class="menu-items active" id="descuentos-menu">
                    <div class="menu-item" onclick="showSection('descuentos')">Descuentos</div>
                    <div class="menu-item" onclick="showSection('vacaciones')">Vacaciones</div>
                    <div class="menu-item" onclick="showSection('licencias')">Licencias</div>
                    <div class="menu-item" onclick="showSection('asociaciones')">Asociaciones</div>
                </div>
            </div>

            <!-- GRUPO: EMPLEADOS Y LIQUIDACIONES -->
            <div class="menu-group">
                <div class="menu-title active" onclick="toggleMenu('empleados-menu')">
                    <span>üë• Empleados y Liquidaciones</span>
                    <i>‚ñº</i>
                </div>
                <div class="menu-items active" id="empleados-menu">
                    <div class="menu-item" onclick="showSection('empleados')">Gesti√≥n de Empleados</div>
                    <div class="menu-item" onclick="showSection('liquidaciones')">C√°lculo de Liquidaciones</div>
                    <div class="menu-item" onclick="showSection('reportes')">Reportes y Recibos</div>
                </div>
            </div>
        </div>

        <!-- CONTENIDO PRINCIPAL -->
        <div class="main-content">
            <header>
                <h1>Sistema de Liquidaci√≥n de Sueldos</h1>
                <p>Entrega 4: Generaci√≥n de Recibos y Reportes de N√≥mina</p>
            </header>

            <div class="content">
                <!-- SECCI√ìN CONVENIOS -->
                <div id="convenios" class="section active">
                    <h2>Convenios Colectivos de Trabajo</h2>
                    
                    <div class="form-container">
                        <h3 id="convenio-form-title">Agregar Nuevo Convenio</h3>
                        <form id="convenio-form">
                            <input type="hidden" id="convenio-id">
                            
                            <div class="form-group">
                                <label>Nombre del Convenio*</label>
                                <input type="text" id="convenio-nombre" placeholder="Ej: Empleados de Comercio" required>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>N√∫mero de Convenio*</label>
                                    <input type="text" id="convenio-numero" placeholder="Ej: CCT 130/75" required>
                                </div>
                                <div class="form-group">
                                    <label>Salario B√°sico Mensual*</label>
                                    <input type="number" id="convenio-salario" placeholder="0.00" step="0.01" required>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>Aporte Jubilatorio (%)*</label>
                                    <input type="number" id="convenio-jubilacion" placeholder="11" step="0.01" required>
                                </div>
                                <div class="form-group">
                                    <label>Aporte Obra Social (%)*</label>
                                    <input type="number" id="convenio-obra-social" placeholder="3" step="0.01" required>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>Aporte Sindical (%)*</label>
                                    <input type="number" id="convenio-sindical" placeholder="2.5" step="0.01" required>
                                </div>
                                <div class="form-group">
                                    <label>Aporte PAMI (%)*</label>
                                    <input type="number" id="convenio-pami" placeholder="3" step="0.01" required>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Descripci√≥n</label>
                                <textarea id="convenio-descripcion" rows="3" placeholder="Descripci√≥n adicional del convenio..."></textarea>
                            </div>

                            <button type="submit" class="btn">Guardar Convenio</button>
                            <button type="button" class="btn btn-danger" onclick="cancelarEdicion('convenio')" style="display:none;" id="convenio-cancelar">Cancelar</button>
                        </form>
                    </div>

                    <div id="convenios-list"></div>
                </div>

                <!-- SECCI√ìN HORAS EXTRAS -->
                <div id="horas-extras" class="section">
                    <h2>Tipos de Horas Extras</h2>
                    
                    <div class="form-container">
                        <h3 id="hora-form-title">Agregar Tipo de Hora Extra</h3>
                        <form id="hora-form">
                            <input type="hidden" id="hora-id">
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Nombre del Tipo*</label>
                                    <input type="text" id="hora-nombre" placeholder="Ej: Hora Extra Diurna" required>
                                </div>
                                <div class="form-group">
                                    <label>Multiplicador*</label>
                                    <input type="number" id="hora-multiplicador" placeholder="1.5" step="0.01" required>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Descripci√≥n</label>
                                <textarea id="hora-descripcion" rows="3" placeholder="Ej: Horas trabajadas entre las 6:00 y 21:00"></textarea>
                            </div>

                            <button type="submit" class="btn">Guardar Tipo</button>
                            <button type="button" class="btn btn-danger" onclick="cancelarEdicion('hora')" style="display:none;" id="hora-cancelar">Cancelar</button>
                        </form>
                    </div>

                    <div id="horas-list"></div>
                </div>

                <!-- SECCI√ìN FERIADOS -->
                <div id="feriados" class="section">
                    <h2>Feriados</h2>
                    
                    <div class="form-container">
                        <h3 id="feriado-form-title">Agregar Feriado</h3>
                        <form id="feriado-form">
                            <input type="hidden" id="feriado-id">
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Nombre del Feriado*</label>
                                    <input type="text" id="feriado-nombre" placeholder="Ej: D√≠a del Trabajador" required>
                                </div>
                                <div class="form-group">
                                    <label>Fecha*</label>
                                    <input type="date" id="feriado-fecha" required>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Tipo de Feriado*</label>
                                <select id="feriado-tipo" required>
                                    <option value="">Seleccionar...</option>
                                    <option value="nacional">Feriado Nacional</option>
                                    <option value="provincial">Feriado Provincial</option>
                                    <option value="inamovible">Feriado Inamovible</option>
                                    <option value="trasladable">Feriado Trasladable</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Descripci√≥n</label>
                                <textarea id="feriado-descripcion" rows="2" placeholder="Informaci√≥n adicional..."></textarea>
                            </div>

                            <button type="submit" class="btn">Guardar Feriado</button>
                            <button type="button" class="btn btn-danger" onclick="cancelarEdicion('feriado')" style="display:none;" id="feriado-cancelar">Cancelar</button>
                        </form>
                    </div>

                    <div id="feriados-list"></div>
                </div>

                <!-- SECCI√ìN ADICIONALES -->
                <div id="adicionales" class="section">
                    <h2>Adicionales (Bonos y Complementos)</h2>
                    
                    <div class="form-container">
                        <h3 id="adicional-form-title">Agregar Adicional</h3>
                        <form id="adicional-form">
                            <input type="hidden" id="adicional-id">
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Nombre del Adicional*</label>
                                    <input type="text" id="adicional-nombre" placeholder="Ej: Presentismo" required>
                                </div>
                                <div class="form-group">
                                    <label>Tipo de C√°lculo*</label>
                                    <select id="adicional-tipo" required>
                                        <option value="">Seleccionar...</option>
                                        <option value="fijo">Monto Fijo</option>
                                        <option value="porcentaje">Porcentaje del Salario</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Valor*</label>
                                <input type="number" id="adicional-valor" placeholder="0.00" step="0.01" required>
                                <small style="color: #6c757d;">Si es porcentaje, ingresar sin el s√≠mbolo % (Ej: 10 para 10%)</small>
                            </div>

                            <div class="form-group">
                                <label>Descripci√≥n</label>
                                <textarea id="adicional-descripcion" rows="2" placeholder="Ej: Bono por asistencia perfecta..."></textarea>
                            </div>

                            <button type="submit" class="btn">Guardar Adicional</button>
                            <button type="button" class="btn btn-danger" onclick="cancelarEdicion('adicional')" style="display:none;" id="adicional-cancelar">Cancelar</button>
                        </form>
                    </div>

                    <div id="adicionales-list"></div>
                </div>

                <!-- SECCI√ìN DESCUENTOS -->
                <div id="descuentos" class="section">
                    <h2>Descuentos</h2>
                    
                    <div class="form-container">
                        <h3 id="descuento-form-title">Agregar Descuento</h3>
                        <form id="descuento-form">
                            <input type="hidden" id="descuento-id">
                            
                            <div class="form-group">
                                <label>Nombre del Descuento*</label>
                                <input type="text" id="descuento-nombre" placeholder="Ej: Adelanto de Sueldo" required>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>Tipo de Descuento*</label>
                                    <select id="descuento-tipo" required>
                                        <option value="">Seleccionar...</option>
                                        <option value="fijo">Monto Fijo</option>
                                        <option value="porcentaje">Porcentaje</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Valor*</label>
                                    <input type="number" id="descuento-valor" placeholder="0.00" step="0.01" required>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="descuento-aplica-aportes">
                                    Aplica sobre base de aportes
                                </label>
                                <small style="color: #6c757d; display: block;">Si est√° marcado, el descuento se calcula sobre la base imponible de aportes</small>
                            </div>

                            <div class="form-group">
                                <label>Descripci√≥n</label>
                                <textarea id="descuento-descripcion" rows="2" placeholder="Descripci√≥n del descuento..."></textarea>
                            </div>

                            <button type="submit" class="btn">Guardar Descuento</button>
                            <button type="button" class="btn btn-danger" onclick="cancelarEdicion('descuento')" style="display:none;" id="descuento-cancelar">Cancelar</button>
                        </form>
                    </div>

                    <div id="descuentos-list"></div>
                </div>

                <!-- SECCI√ìN VACACIONES -->
                <div id="vacaciones" class="section">
                    <h2>Pol√≠ticas de Vacaciones</h2>
                    
                    <div class="form-container">
                        <h3 id="vacacion-form-title">Agregar Pol√≠tica de Vacaciones</h3>
                        <form id="vacacion-form">
                            <input type="hidden" id="vacacion-id">
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Antig√ºedad M√≠nima (a√±os)*</label>
                                    <input type="number" id="vacacion-antiguedad-min" placeholder="0" min="0" required>
                                </div>
                                <div class="form-group">
                                    <label>Antig√ºedad M√°xima (a√±os)</label>
                                    <input type="number" id="vacacion-antiguedad-max" placeholder="Dejar vac√≠o para 'm√°s de'">
                                    <small style="color: #6c757d;">Opcional - dejar vac√≠o para "m√°s de X a√±os"</small>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>D√≠as Base*</label>
                                    <input type="number" id="vacacion-dias-base" placeholder="14" min="1" required>
                                </div>
                                <div class="form-group">
                                    <label>D√≠as Adicionales</label>
                                    <input type="number" id="vacacion-dias-adicionales" placeholder="0" min="0">
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Descripci√≥n</label>
                                <textarea id="vacacion-descripcion" rows="2" placeholder="Ej: Vacaciones para empleados con hasta 5 a√±os de antig√ºedad"></textarea>
                            </div>

                            <button type="submit" class="btn">Guardar Pol√≠tica</button>
                            <button type="button" class="btn btn-danger" onclick="cancelarEdicion('vacacion')" style="display:none;" id="vacacion-cancelar">Cancelar</button>
                        </form>
                    </div>

                    <div id="vacaciones-list"></div>
                </div>

                <!-- SECCI√ìN LICENCIAS -->
                <div id="licencias" class="section">
                    <h2>Tipos de Licencias</h2>
                    
                    <div class="form-container">
                        <h3 id="licencia-form-title">Agregar Tipo de Licencia</h3>
                        <form id="licencia-form">
                            <input type="hidden" id="licencia-id">
                            
                            <div class="form-group">
                                <label>Nombre de la Licencia*</label>
                                <input type="text" id="licencia-nombre" placeholder="Ej: Licencia por Enfermedad" required>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>L√≠mite de D√≠as</label>
                                    <input type="number" id="licencia-limite-dias" placeholder="Ej: 30 (opcional)" min="1">
                                    <small style="color: #6c757d;">Dejar vac√≠o si no hay l√≠mite</small>
                                </div>
                                <div class="form-group">
                                    <label style="display: block; margin-bottom: 10px;">
                                        <input type="checkbox" id="licencia-con-goce" checked>
                                        Con goce de sueldo
                                    </label>
                                    <label style="display: block;">
                                        <input type="checkbox" id="licencia-requiere-certificado">
                                        Requiere certificado
                                    </label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Descripci√≥n</label>
                                <textarea id="licencia-descripcion" rows="2" placeholder="Descripci√≥n de la licencia..."></textarea>
                            </div>

                            <button type="submit" class="btn">Guardar Licencia</button>
                            <button type="button" class="btn btn-danger" onclick="cancelarEdicion('licencia')" style="display:none;" id="licencia-cancelar">Cancelar</button>
                        </form>
                    </div>

                    <div id="licencias-list"></div>
                </div>

                <!-- SECCI√ìN ASOCIACIONES -->
                <div id="asociaciones" class="section">
                    <h2>Asociar Conceptos a Convenios</h2>
                    
                    <div class="form-container">
                        <h3>Asociar Descuentos a Convenio</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Seleccionar Convenio</label>
                                <select id="asociacion-convenio">
                                    <option value="">Cargando convenios...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Seleccionar Descuento</label>
                                <select id="asociacion-descuento">
                                    <option value="">Cargando descuentos...</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Fecha Desde*</label>
                                <input type="date" id="asociacion-fecha-desde" required>
                            </div>
                            <div class="form-group">
                                <label>Fecha Hasta</label>
                                <input type="date" id="asociacion-fecha-hasta">
                                <small style="color: #6c757d;">Opcional - dejar vac√≠o para vigencia indefinida</small>
                            </div>
                        </div>
                        <button type="button" class="btn" onclick="asociarDescuento()">Asociar Descuento</button>
                    </div>

                    <div class="form-container">
                        <h3>Asociar Licencias a Convenio</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Seleccionar Convenio</label>
                                <select id="asociacion-licencia-convenio">
                                    <option value="">Cargando convenios...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Seleccionar Licencia</label>
                                <select id="asociacion-licencia">
                                    <option value="">Cargando licencias...</option>
                                </select>
                            </div>
                        </div>
                        <button type="button" class="btn" onclick="asociarLicencia()">Asociar Licencia</button>
                    </div>

                    <div id="asociaciones-list"></div>
                </div>  



                <!-- SECCI√ìN EMPLEADOS -->
                <div id="empleados" class="section">
                    <h2>Gesti√≥n de Empleados</h2>
                    
                    <div class="form-container">
                        <h3 id="empleado-form-title">Agregar Nuevo Empleado</h3>
                        <form id="empleado-form">
                            <input type="hidden" id="empleado-id">
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Legajo*</label>
                                    <input type="text" id="empleado-legajo" placeholder="Ej: EMP-001" required>
                                </div>
                                <div class="form-group">
                                    <label>DNI*</label>
                                    <input type="text" id="empleado-dni" placeholder="Ej: 12345678" required>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>Nombre*</label>
                                    <input type="text" id="empleado-nombre" placeholder="Ej: Juan" required>
                                </div>
                                <div class="form-group">
                                    <label>Apellido*</label>
                                    <input type="text" id="empleado-apellido" placeholder="Ej: P√©rez" required>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>Fecha de Nacimiento</label>
                                    <input type="date" id="empleado-fecha-nacimiento">
                                </div>
                                <div class="form-group">
                                    <label>Fecha de Ingreso*</label>
                                    <input type="date" id="empleado-fecha-ingreso" required>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>Email</label>
                                    <input type="email" id="empleado-email" placeholder="Ej: juan@empresa.com">
                                </div>
                                <div class="form-group">
                                    <label>Tel√©fono</label>
                                    <input type="text" id="empleado-telefono" placeholder="Ej: +54 11 1234-5678">
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Direcci√≥n</label>
                                <textarea id="empleado-direccion" rows="2" placeholder="Direcci√≥n completa..."></textarea>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>Salario Base*</label>
                                    <input type="number" id="empleado-salario-base" placeholder="0.00" step="0.01" required>
                                </div>
                                <div class="form-group">
                                    <label>Convenio</label>
                                    <select id="empleado-convenio">
                                        <option value="">Seleccionar convenio...</option>
                                    </select>
                                </div>
                            </div>

                            <button type="submit" class="btn">Guardar Empleado</button>
                            <button type="button" class="btn btn-danger" onclick="cancelarEdicion('empleado')" style="display:none;" id="empleado-cancelar">Cancelar</button>
                        </form>
                    </div>

                    <div id="empleados-list"></div>
                </div>

                <!-- SECCI√ìN C√ÅLCULO DE LIQUIDACI√ìN -->
                <div id="liquidaciones" class="section">
                    <h2>C√°lculo de Liquidaciones</h2>
                    
                    <div class="form-container">
                        <h3>Calcular Liquidaci√≥n</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Seleccionar Empleado*</label>
                                <select id="liquidacion-empleado">
                                    <option value="">Cargando empleados...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Per√≠odo*</label>
                                <input type="month" id="liquidacion-periodo" required>
                            </div>
                        </div>
                        <button type="button" class="btn" onclick="calcularLiquidacion()">Calcular Liquidaci√≥n</button>
                        <button type="button" class="btn" onclick="guardarLiquidacion()" style="display:none;" id="btn-guardar-liquidacion">Guardar Liquidaci√≥n</button>
                    </div>

                    <div id="resultado-liquidacion" style="display: none;">
                        <div class="form-container">
                            <h3>Resultado del C√°lculo</h3>
                            <div id="detalle-liquidacion"></div>
                        </div>
                    </div>

                    <!-- Formularios para agregar conceptos -->
                    <div class="form-row">
                        <div class="form-container">
                            <h4>Agregar Horas Extras</h4>
                            <form id="hora-extra-form">
                                <input type="hidden" id="hora-extra-empleado-id">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Tipo de Hora Extra</label>
                                        <select id="hora-extra-tipo">
                                            <option value="">Cargando tipos...</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Cantidad (horas)</label>
                                        <input type="number" id="hora-extra-cantidad" step="0.5" min="0.5" value="1">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Fecha</label>
                                        <input type="date" id="hora-extra-fecha">
                                    </div>
                                    <div class="form-group">
                                        <label>Descripci√≥n</label>
                                        <input type="text" id="hora-extra-descripcion" placeholder="Descripci√≥n opcional">
                                    </div>
                                </div>
                                <button type="submit" class="btn">Agregar Hora Extra</button>
                            </form>
                        </div>

                        <div class="form-container">
                            <h4>Agregar Adicional</h4>
                            <form id="adicional-empleado-form">
                                <input type="hidden" id="adicional-empleado-id">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Adicional</label>
                                        <select id="adicional-empleado-tipo">
                                            <option value="">Cargando adicionales...</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Monto</label>
                                        <input type="number" id="adicional-empleado-monto" step="0.01" min="0">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Fecha</label>
                                        <input type="date" id="adicional-empleado-fecha">
                                    </div>
                                    <div class="form-group">
                                        <label>Descripci√≥n</label>
                                        <input type="text" id="adicional-empleado-descripcion" placeholder="Descripci√≥n del adicional">
                                    </div>
                                </div>
                                <button type="submit" class="btn">Agregar Adicional</button>
                            </form>
                        </div>
                    </div>

                    <div class="form-container">
                        <h4>Agregar Descuento</h4>
                        <form id="descuento-empleado-form">
                            <input type="hidden" id="descuento-empleado-id">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Descuento</label>
                                    <select id="descuento-empleado-tipo">
                                        <option value="">Cargando descuentos...</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Monto</label>
                                    <input type="number" id="descuento-empleado-monto" step="0.01" min="0">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Fecha</label>
                                    <input type="date" id="descuento-empleado-fecha">
                                </div>
                                <div class="form-group">
                                    <label>Descripci√≥n</label>
                                    <input type="text" id="descuento-empleado-descripcion" placeholder="Descripci√≥n del descuento">
                                </div>
                            </div>
                            <button type="submit" class="btn">Agregar Descuento</button>
                        </form>
                    </div>
                </div>


                <!-- SECCI√ìN REPORTES Y RECIBOS -->
                <div id="reportes" class="section">
                    <h2>üìä Reportes y Recibos de Sueldo</h2>
                    
                    <!-- GENERACI√ìN DE RECIBOS INDIVIDUALES -->
                    <div class="form-container">
                        <h3>üìÑ Generar Recibo de Sueldo Individual</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Seleccionar Empleado*</label>
                                <select id="recibo-empleado">
                                    <option value="">Cargando empleados...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Per√≠odo*</label>
                                <input type="month" id="recibo-periodo" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <button type="button" class="btn" onclick="generarRecibo()">Generar Recibo</button>
                                <button type="button" class="btn" onclick="imprimirRecibo()" style="display:none;" id="btn-imprimir-recibo">Imprimir Recibo</button>
                                <button type="button" class="btn" onclick="descargarReciboPDF()" style="display:none;" id="btn-descargar-recibo">Descargar PDF</button>
                            </div>
                        </div>
                    </div>

                    <!-- VISTA PREVIA DEL RECIBO -->
                    <div id="vista-previa-recibo" style="display: none;">
                        <div class="form-container">
                            <h3>Vista Previa del Recibo</h3>
                            <div id="contenido-recibo"></div>
                        </div>
                    </div>

                    <!-- REPORTE DE N√ìMINA -->
                    <div class="form-container">
                        <h3>üìã Generar Reporte de N√≥mina</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Per√≠odo*</label>
                                <input type="month" id="nomina-periodo" required>
                            </div>
                            <div class="form-group">
                                <label>Tipo de Reporte</label>
                                <select id="tipo-reporte" onchange="toggleSeleccionEmpleados()">
                                    <option value="todos">Todos los empleados</option>
                                    <option value="seleccionados">Empleados seleccionados</option>
                                </select>
                            </div>
                        </div>

                        <!-- SELECTOR DE EMPLEADOS (solo visible cuando se selecciona "seleccionados") -->
                        <div id="selector-empleados" style="display: none;">
                            <div class="form-group">
                                <label>Seleccionar Empleados</label>
                                <div id="lista-empleados-checkbox" style="max-height: 200px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; border-radius: 5px;">
                                    <!-- Aqu√≠ se cargar√°n los checkboxes de empleados -->
                                </div>
                            </div>
                        </div>

                        <button type="button" class="btn" onclick="generarReporteNomina()">Generar Reporte de N√≥mina</button>
                        <button type="button" class="btn" onclick="exportarExcel()" style="display:none;" id="btn-exportar-excel">Exportar a Excel</button>
                    </div>

                    <!-- RESULTADO DEL REPORTE DE N√ìMINA -->
                    <div id="resultado-nomina" style="display: none;">
                        <div class="form-container">
                            <h3>Resultado del Reporte de N√≥mina</h3>
                            <div id="detalle-nomina"></div>
                        </div>
                    </div>
                </div>



            </div>
        </div>
    </div>

    <script>
        // Configuraci√≥n de la API
        const API_URL = 'http://localhost:3000/api';

      
        // ============================================
        // DASHBOARD
        // ============================================

        function showDashboard() {
            window.open('dashboard.html', '_blank');
            // O si prefieres que se abra en la misma pesta√±a:
            // window.location.href = 'dashboard.html';
        }

        // ============================================
// SISTEMA DE NOTIFICACIONES
// ============================================



function showNotification(type, title, message, duration = 5000) {
    const container = document.getElementById('notifications-container');
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    
    const icons = {
        success: '‚úì',
        error: '‚úó',
        warning: '‚ö†',
        info: '‚Ñπ'
    };

    notification.innerHTML = `
        <div class="notification-icon">${icons[type]}</div>
        <div class="notification-content">
            <div class="notification-title">${title}</div>
            <div class="notification-message">${message}</div>
        </div>
        <button class="notification-close" onclick="closeNotification(this)">√ó</button>
    `;

    container.appendChild(notification);

    // Animaci√≥n de entrada
    setTimeout(() => {
        notification.classList.add('show');
    }, 10);

    // Auto-eliminaci√≥n despu√©s del tiempo especificado
    if (duration > 0) {
        setTimeout(() => {
            closeNotification(notification.querySelector('.notification-close'));
        }, duration);
    }

    return notification;
}

function closeNotification(closeButton) {
    const notification = closeButton.closest('.notification');
    notification.classList.remove('show');
    notification.classList.add('hide');
    
    setTimeout(() => {
        if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
        }
    }, 300);
}

// Funci√≥n auxiliar para mostrar resultados de operaciones
function showOperationResult(operation, success, customMessage = null) {
    const messages = {
        create: {
            success: 'creado exitosamente',
            error: 'Error al crear'
        },
        update: {
            success: 'actualizado exitosamente',
            error: 'Error al actualizar'
        },
        delete: {
            success: 'eliminado exitosamente',
            error: 'Error al eliminar'
        },
        load: {
            success: 'cargado exitosamente',
            error: 'Error al cargar'
        },
        associate: {
            success: 'asociado exitosamente',
            error: 'Error al asociar'
        }
    };

    const type = success ? 'success' : 'error';
    const baseMessage = messages[operation] ? messages[operation][type] : (success ? 'Operaci√≥n completada' : 'Error en la operaci√≥n');
    const message = customMessage || baseMessage;
    const title = success ? 'Operaci√≥n Exitosa' : 'Error';

    showNotification(type, title, message);
}

        // Verificar conexi√≥n al cargar la p√°gina
        async function verificarConexion() {
            try {
                const response = await fetch(`${API_URL}/convenios`);
                if (response.ok) {
                    document.getElementById('db-status').textContent = '‚úì PostgreSQL Conectado';
                    document.getElementById('db-status').classList.remove('offline');
                    showNotification('success', 'Conexi√≥n Exitosa', 'Conectado a la base de datos PostgreSQL');
                }
            } catch (error) {
                document.getElementById('db-status').textContent = '‚úó Sin conexi√≥n al servidor';
                document.getElementById('db-status').classList.add('offline');
                // console.error('Error de conexi√≥n:', error);
                showNotification('error', 'Error de Conexi√≥n', 'No se pudo conectar al servidor. Verifica que est√© corriendo.');
                showNotification('error', 'Error de Conexi√≥n', 'Mismo numero de convenio');
            }
        }

        // Funciones para la barra lateral
        function toggleMenu(menuId) {
            const menu = document.getElementById(menuId);
            const title = menu.previousElementSibling;
            
            menu.classList.toggle('active');
            title.classList.toggle('active');
        }

        // Navegaci√≥n entre secciones
        function showSection(sectionName) {
            // Ocultar todas las secciones
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            
            // Remover active de todos los items del men√∫
            document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active'));
            
            // Mostrar secci√≥n seleccionada
            document.getElementById(sectionName).classList.add('active');
            
            // Activar item del men√∫ correspondiente
            const menuItem = document.querySelector(`.menu-item[onclick="showSection('${sectionName}')"]`);
            if (menuItem) {
                menuItem.classList.add('active');
            }
        }

        // ============================================
        // CONVENIOS
        // ============================================
        
        async function cargarConvenios() {
            const container = document.getElementById('convenios-list');
            container.innerHTML = '<div class="loading">Cargando convenios...</div>';

            try {
                const response = await fetch(`${API_URL}/convenios`);
                const convenios = await response.json();

                if (convenios.length === 0) {
                    container.innerHTML = '<div class="empty-state"><p>No hay convenios registrados</p></div>';
                    return;
                }

                let html = '<table><thead><tr><th>Nombre</th><th>N√∫mero</th><th>Salario B√°sico</th><th>Aportes Totales</th><th>Acciones</th></tr></thead><tbody>';
                
                convenios.forEach(c => {
                    const aportesTotales = parseFloat(c.aporte_jubilacion) + parseFloat(c.aporte_obra_social) + 
                                          parseFloat(c.aporte_sindical) + parseFloat(c.aporte_pami);
                    html += `
                        <tr>
                            <td><strong>${c.nombre}</strong></td>
                            <td>${c.numero}</td>
                            <td>$${parseFloat(c.salario_basico).toLocaleString('es-AR', {minimumFractionDigits: 2})}</td>
                            <td>${aportesTotales.toFixed(2)}%</td>
                            <td>
                                <button class="btn btn-edit" onclick="editarConvenio(${c.id})">Editar</button>
                                <button class="btn btn-danger" style="padding: 8px 16px; font-size: 12px;" onclick="eliminarConvenio(${c.id})">Eliminar</button>
                            </td>
                        </tr>
                    `;
                });
                
                html += '</tbody></table>';
                container.innerHTML = html;
                showOperationResult('load', true, 'Convenios cargados correctamente');
            } catch (error) {
                
                showOperationResult('load', false, 'Error al cargar convenios');

            }
            showOperationResult('load', true, 'Convenios cargados correctamente');
        }

        document.getElementById('convenio-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const id = document.getElementById('convenio-id').value;
            const data = {
                nombre: document.getElementById('convenio-nombre').value,
                numero: document.getElementById('convenio-numero').value,
                salario_basico: parseFloat(document.getElementById('convenio-salario').value),
                aporte_jubilacion: parseFloat(document.getElementById('convenio-jubilacion').value),
                aporte_obra_social: parseFloat(document.getElementById('convenio-obra-social').value),
                aporte_sindical: parseFloat(document.getElementById('convenio-sindical').value),
                aporte_pami: parseFloat(document.getElementById('convenio-pami').value),
                descripcion: document.getElementById('convenio-descripcion').value
            };

            try {
                const url = id ? `${API_URL}/convenios/${id}` : `${API_URL}/convenios`;
                const method = id ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    this.reset();
                    document.getElementById('convenio-id').value = '';
                    document.getElementById('convenio-cancelar').style.display = 'none';
                    document.getElementById('convenio-form-title').textContent = 'Agregar Nuevo Convenio';
                    cargarConvenios();
                    // alert(id ? 'Convenio actualizado exitosamente' : 'Convenio creado exitosamente');
                    const operation = id ? 'update' : 'create';
                    showOperationResult(operation, true);
                } else {
                    // const error = await response.json();
                    // alert('Error: ' + error.error);
                    showOperationResult(id ? 'update' : 'create', false, error.error);
                }
            } catch (error) {
                // alert('Error al guardar convenio. Verifica la conexi√≥n al servidor.');
                // console.error('Error:', error);
                showOperationResult(id ? 'update' : 'create', false, 'Error de conexi√≥n al servidor');
            }
        });

        async function editarConvenio(id) {
            try {
                const response = await fetch(`${API_URL}/convenios/${id}`);
                const convenio = await response.json();
                
                document.getElementById('convenio-id').value = convenio.id;
                document.getElementById('convenio-nombre').value = convenio.nombre;
                document.getElementById('convenio-numero').value = convenio.numero;
                document.getElementById('convenio-salario').value = convenio.salario_basico;
                document.getElementById('convenio-jubilacion').value = convenio.aporte_jubilacion;
                document.getElementById('convenio-obra-social').value = convenio.aporte_obra_social;
                document.getElementById('convenio-sindical').value = convenio.aporte_sindical;
                document.getElementById('convenio-pami').value = convenio.aporte_pami;
                document.getElementById('convenio-descripcion').value = convenio.descripcion || '';
                document.getElementById('convenio-cancelar').style.display = 'inline-block';
                document.getElementById('convenio-form-title').textContent = 'Editar Convenio';
                window.scrollTo(0, 0);
                showNotification('info', 'Modo Edici√≥n', 'Editando convenio: ' + convenio.nombre);
            } catch (error) {
                alert('Error al cargar convenio para editar');
                console.error('Error:', error);
            }
        }

        async function eliminarConvenio(id) {
            if (!confirm('¬øEst√°s seguro de eliminar este convenio?')) return;
            
            try {
                const response = await fetch(`${API_URL}/convenios/${id}`, { method: 'DELETE' });
                if (response.ok) {
                    cargarConvenios();
                    alert('Convenio eliminado exitosamente');
                    showOperationResult('delete', true);
                }
            } catch (error) {
                alert('Error al eliminar convenio');
                console.error('Error:', error);
            }
        }

        // ============================================
        // HORAS EXTRAS
        // ============================================
        
        async function cargarHorasExtras() {
            const container = document.getElementById('horas-list');
            container.innerHTML = '<div class="loading">Cargando horas extras...</div>';

            try {
                const response = await fetch(`${API_URL}/horas-extras`);
                const horas = await response.json();

                if (horas.length === 0) {
                    container.innerHTML = '<div class="empty-state"><p>No hay tipos de horas extras configurados</p></div>';
                    return;
                }

                let html = '<table><thead><tr><th>Tipo</th><th>Multiplicador</th><th>Descripci√≥n</th><th>Acciones</th></tr></thead><tbody>';
                
                horas.forEach(h => {
                    html += `
                        <tr>
                            <td><strong>${h.nombre}</strong></td>
                            <td>${parseFloat(h.multiplicador).toFixed(2)}x</td>
                            <td>${h.descripcion || '-'}</td>
                            <td>
                                <button class="btn btn-edit" onclick="editarHora(${h.id})">Editar</button>
                                <button class="btn btn-danger" style="padding: 8px 16px; font-size: 12px;" onclick="eliminarHora(${h.id})">Eliminar</button>
                            </td>
                        </tr>
                    `;
                });
                
                html += '</tbody></table>';
                container.innerHTML = html;
            } catch (error) {
                container.innerHTML = '<div class="alert alert-error">Error al cargar horas extras</div>';
                console.error('Error:', error);
            }
        }

        document.getElementById('hora-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const id = document.getElementById('hora-id').value;
            const data = {
                nombre: document.getElementById('hora-nombre').value,
                multiplicador: parseFloat(document.getElementById('hora-multiplicador').value),
                descripcion: document.getElementById('hora-descripcion').value
            };

            try {
                const url = id ? `${API_URL}/horas-extras/${id}` : `${API_URL}/horas-extras`;
                const method = id ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    this.reset();
                    document.getElementById('hora-id').value = '';
                    document.getElementById('hora-cancelar').style.display = 'none';
                    document.getElementById('hora-form-title').textContent = 'Agregar Tipo de Hora Extra';
                    cargarHorasExtras();
                    alert(id ? 'Hora extra actualizada' : 'Hora extra creada');
                }
            } catch (error) {
                alert('Error al guardar hora extra');
                console.error('Error:', error);
            }
        });

        async function editarHora(id) {
            try {
                const response = await fetch(`${API_URL}/horas-extras`);
                const horas = await response.json();
                const hora = horas.find(h => h.id === id);
                
                document.getElementById('hora-id').value = hora.id;
                document.getElementById('hora-nombre').value = hora.nombre;
                document.getElementById('hora-multiplicador').value = hora.multiplicador;
                document.getElementById('hora-descripcion').value = hora.descripcion || '';
                document.getElementById('hora-cancelar').style.display = 'inline-block';
                document.getElementById('hora-form-title').textContent = 'Editar Tipo de Hora Extra';
                window.scrollTo(0, 0);
            } catch (error) {
                alert('Error al cargar hora extra');
                console.error('Error:', error);
            }
        }

        async function eliminarHora(id) {
            if (!confirm('¬øEst√°s seguro de eliminar este tipo de hora extra?')) return;
            
            try {
                const response = await fetch(`${API_URL}/horas-extras/${id}`, { method: 'DELETE' });
                if (response.ok) {
                    cargarHorasExtras();
                    alert('Hora extra eliminada');
                }
            } catch (error) {
                alert('Error al eliminar hora extra');
                console.error('Error:', error);
            }
        }

        // ============================================
        // FERIADOS
        // ============================================
        
        async function cargarFeriados() {
            const container = document.getElementById('feriados-list');
            container.innerHTML = '<div class="loading">Cargando feriados...</div>';

            try {
                const response = await fetch(`${API_URL}/feriados`);
                const feriados = await response.json();

                if (feriados.length === 0) {
                    container.innerHTML = '<div class="empty-state"><p>No hay feriados registrados</p></div>';
                    return;
                }

                let html = '<table><thead><tr><th>Nombre</th><th>Fecha</th><th>Tipo</th><th>Descripci√≥n</th><th>Acciones</th></tr></thead><tbody>';
                
                feriados.forEach(f => {
                    const fecha = new Date(f.fecha + 'T00:00:00');
                    const fechaFormateada = fecha.toLocaleDateString('es-AR');
                    html += `
                        <tr>
                            <td><strong>${f.nombre}</strong></td>
                            <td>${fechaFormateada}</td>
                            <td>${f.tipo}</td>
                            <td>${f.descripcion || '-'}</td>
                            <td>
                                <button class="btn btn-edit" onclick="editarFeriado(${f.id})">Editar</button>
                                <button class="btn btn-danger" style="padding: 8px 16px; font-size: 12px;" onclick="eliminarFeriado(${f.id})">Eliminar</button>
                            </td>
                        </tr>
                    `;
                });
                
                html += '</tbody></table>';
                container.innerHTML = html;
            } catch (error) {
                container.innerHTML = '<div class="alert alert-error">Error al cargar feriados</div>';
                console.error('Error:', error);
            }
        }

        document.getElementById('feriado-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const id = document.getElementById('feriado-id').value;
            const data = {
                nombre: document.getElementById('feriado-nombre').value,
                fecha: document.getElementById('feriado-fecha').value,
                tipo: document.getElementById('feriado-tipo').value,
                descripcion: document.getElementById('feriado-descripcion').value
            };

            try {
                const url = id ? `${API_URL}/feriados/${id}` : `${API_URL}/feriados`;
                const method = id ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    this.reset();
                    document.getElementById('feriado-id').value = '';
                    document.getElementById('feriado-cancelar').style.display = 'none';
                    document.getElementById('feriado-form-title').textContent = 'Agregar Feriado';
                    cargarFeriados();
                    alert(id ? 'Feriado actualizado' : 'Feriado creado');
                }
            } catch (error) {
                alert('Error al guardar feriado');
                console.error('Error:', error);
            }
        });

        async function editarFeriado(id) {
            try {
                const response = await fetch(`${API_URL}/feriados`);
                const feriados = await response.json();
                const feriado = feriados.find(f => f.id === id);
                
                document.getElementById('feriado-id').value = feriado.id;
                document.getElementById('feriado-nombre').value = feriado.nombre;
                document.getElementById('feriado-fecha').value = feriado.fecha;
                document.getElementById('feriado-tipo').value = feriado.tipo;
                document.getElementById('feriado-descripcion').value = feriado.descripcion || '';
                document.getElementById('feriado-cancelar').style.display = 'inline-block';
                document.getElementById('feriado-form-title').textContent = 'Editar Feriado';
                window.scrollTo(0, 0);
            } catch (error) {
                alert('Error al cargar feriado');
                console.error('Error:', error);
            }
        }

        async function eliminarFeriado(id) {
            if (!confirm('¬øEst√°s seguro de eliminar este feriado?')) return;
            
            try {
                const response = await fetch(`${API_URL}/feriados/${id}`, { method: 'DELETE' });
                if (response.ok) {
                    cargarFeriados();
                    alert('Feriado eliminado');
                }
            } catch (error) {
                alert('Error al eliminar feriado');
                console.error('Error:', error);
            }
        }

        // ============================================
        // ADICIONALES
        // ============================================
        
        async function cargarAdicionales() {
            const container = document.getElementById('adicionales-list');
            container.innerHTML = '<div class="loading">Cargando adicionales...</div>';

            try {
                const response = await fetch(`${API_URL}/adicionales`);
                const adicionales = await response.json();

                if (adicionales.length === 0) {
                    container.innerHTML = '<div class="empty-state"><p>No hay adicionales configurados</p></div>';
                    return;
                }

                let html = '<table><thead><tr><th>Nombre</th><th>Tipo</th><th>Valor</th><th>Descripci√≥n</th><th>Acciones</th></tr></thead><tbody>';
                
                adicionales.forEach(a => {
                    const valorTexto = a.tipo === 'fijo' 
                        ? `${parseFloat(a.valor).toLocaleString('es-AR', {minimumFractionDigits: 2})}`
                        : `${parseFloat(a.valor).toFixed(2)}%`;
                    
                    html += `
                        <tr>
                            <td><strong>${a.nombre}</strong></td>
                            <td>${a.tipo === 'fijo' ? 'Monto Fijo' : 'Porcentaje'}</td>
                            <td>${valorTexto}</td>
                            <td>${a.descripcion || '-'}</td>
                            <td>
                                <button class="btn btn-edit" onclick="editarAdicional(${a.id})">Editar</button>
                                <button class="btn btn-danger" style="padding: 8px 16px; font-size: 12px;" onclick="eliminarAdicional(${a.id})">Eliminar</button>
                            </td>
                        </tr>
                    `;
                });
                
                html += '</tbody></table>';
                container.innerHTML = html;
            } catch (error) {
                container.innerHTML = '<div class="alert alert-error">Error al cargar adicionales</div>';
                console.error('Error:', error);
            }
        }

        document.getElementById('adicional-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const id = document.getElementById('adicional-id').value;
            const data = {
                nombre: document.getElementById('adicional-nombre').value,
                tipo: document.getElementById('adicional-tipo').value,
                valor: parseFloat(document.getElementById('adicional-valor').value),
                descripcion: document.getElementById('adicional-descripcion').value
            };

            try {
                const url = id ? `${API_URL}/adicionales/${id}` : `${API_URL}/adicionales`;
                const method = id ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    this.reset();
                    document.getElementById('adicional-id').value = '';
                    document.getElementById('adicional-cancelar').style.display = 'none';
                    document.getElementById('adicional-form-title').textContent = 'Agregar Adicional';
                    cargarAdicionales();
                    alert(id ? 'Adicional actualizado' : 'Adicional creado');
                }
            } catch (error) {
                alert('Error al guardar adicional');
                console.error('Error:', error);
            }
        });

        async function editarAdicional(id) {
            try {
                const response = await fetch(`${API_URL}/adicionales`);
                const adicionales = await response.json();
                const adicional = adicionales.find(a => a.id === id);
                
                document.getElementById('adicional-id').value = adicional.id;
                document.getElementById('adicional-nombre').value = adicional.nombre;
                document.getElementById('adicional-tipo').value = adicional.tipo;
                document.getElementById('adicional-valor').value = adicional.valor;
                document.getElementById('adicional-descripcion').value = adicional.descripcion || '';
                document.getElementById('adicional-cancelar').style.display = 'inline-block';
                document.getElementById('adicional-form-title').textContent = 'Editar Adicional';
                window.scrollTo(0, 0);
            } catch (error) {
                alert('Error al cargar adicional');
                console.error('Error:', error);
            }
        }

        async function eliminarAdicional(id) {
            if (!confirm('¬øEst√°s seguro de eliminar este adicional?')) return;
            
            try {
                const response = await fetch(`${API_URL}/adicionales/${id}`, { method: 'DELETE' });
                if (response.ok) {
                    cargarAdicionales();
                    alert('Adicional eliminado');
                }
            } catch (error) {
                alert('Error al eliminar adicional');
                console.error('Error:', error);
            }
        }

        // ============================================
        // DESCUENTOS
        // ============================================
        
        async function cargarDescuentos() {
            const container = document.getElementById('descuentos-list');
            container.innerHTML = '<div class="loading">Cargando descuentos...</div>';

            try {
                const response = await fetch(`${API_URL}/descuentos`);
                const descuentos = await response.json();

                if (descuentos.length === 0) {
                    container.innerHTML = '<div class="empty-state"><p>No hay descuentos configurados</p></div>';
                    return;
                }

                let html = '<table><thead><tr><th>Nombre</th><th>Tipo</th><th>Valor</th><th>Aplica Aportes</th><th>Descripci√≥n</th><th>Acciones</th></tr></thead><tbody>';
                
                descuentos.forEach(d => {
                    const valorTexto = d.tipo === 'fijo' 
                        ? `$${parseFloat(d.valor).toLocaleString('es-AR', {minimumFractionDigits: 2})}`
                        : `${parseFloat(d.valor).toFixed(2)}%`;
                    
                    html += `
                        <tr>
                            <td><strong>${d.nombre}</strong></td>
                            <td>${d.tipo === 'fijo' ? 'Monto Fijo' : 'Porcentaje'}</td>
                            <td>${valorTexto}</td>
                            <td>${d.aplica_aportes ? 'S√≠' : 'No'}</td>
                            <td>${d.descripcion || '-'}</td>
                            <td>
                                <button class="btn btn-edit" onclick="editarDescuento(${d.id})">Editar</button>
                                <button class="btn btn-danger" style="padding: 8px 16px; font-size: 12px;" onclick="eliminarDescuento(${d.id})">Eliminar</button>
                            </td>
                        </tr>
                    `;
                });
                
                html += '</tbody></table>';
                container.innerHTML = html;
            } catch (error) {
                container.innerHTML = '<div class="alert alert-error">Error al cargar descuentos</div>';
                console.error('Error:', error);
            }
        }

        document.getElementById('descuento-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const id = document.getElementById('descuento-id').value;
            const data = {
                nombre: document.getElementById('descuento-nombre').value,
                tipo: document.getElementById('descuento-tipo').value,
                valor: parseFloat(document.getElementById('descuento-valor').value),
                aplica_aportes: document.getElementById('descuento-aplica-aportes').checked,
                descripcion: document.getElementById('descuento-descripcion').value
            };

            try {
                const url = id ? `${API_URL}/descuentos/${id}` : `${API_URL}/descuentos`;
                const method = id ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    this.reset();
                    document.getElementById('descuento-id').value = '';
                    document.getElementById('descuento-cancelar').style.display = 'none';
                    document.getElementById('descuento-form-title').textContent = 'Agregar Descuento';
                    cargarDescuentos();
                    alert(id ? 'Descuento actualizado' : 'Descuento creado');
                }
            } catch (error) {
                alert('Error al guardar descuento');
                console.error('Error:', error);
            }
        });

        async function editarDescuento(id) {
            try {
                const response = await fetch(`${API_URL}/descuentos/${id}`);
                const descuento = await response.json();
                
                document.getElementById('descuento-id').value = descuento.id;
                document.getElementById('descuento-nombre').value = descuento.nombre;
                document.getElementById('descuento-tipo').value = descuento.tipo;
                document.getElementById('descuento-valor').value = descuento.valor;
                document.getElementById('descuento-aplica-aportes').checked = descuento.aplica_aportes;
                document.getElementById('descuento-descripcion').value = descuento.descripcion || '';
                document.getElementById('descuento-cancelar').style.display = 'inline-block';
                document.getElementById('descuento-form-title').textContent = 'Editar Descuento';
                window.scrollTo(0, 0);
            } catch (error) {
                alert('Error al cargar descuento');
                console.error('Error:', error);
            }
        }

        async function eliminarDescuento(id) {
            if (!confirm('¬øEst√°s seguro de eliminar este descuento?')) return;
            
            try {
                const response = await fetch(`${API_URL}/descuentos/${id}`, { method: 'DELETE' });
                if (response.ok) {
                    cargarDescuentos();
                    alert('Descuento eliminado');
                }
            } catch (error) {
                alert('Error al eliminar descuento');
                console.error('Error:', error);
            }
        }

        // ============================================
        // VACACIONES
        // ============================================

        async function cargarVacaciones() {
            const container = document.getElementById('vacaciones-list');
            container.innerHTML = '<div class="loading">Cargando pol√≠ticas de vacaciones...</div>';

            try {
                const response = await fetch(`${API_URL}/politicas-vacaciones`);
                const vacaciones = await response.json();

                if (vacaciones.length === 0) {
                    container.innerHTML = '<div class="empty-state"><p>No hay pol√≠ticas de vacaciones configuradas</p></div>';
                    return;
                }

                let html = '<table><thead><tr><th>Rango de Antig√ºedad</th><th>D√≠as Base</th><th>D√≠as Adicionales</th><th>Total D√≠as</th><th>Descripci√≥n</th><th>Acciones</th></tr></thead><tbody>';
                
                vacaciones.forEach(v => {
                    const rango = v.antiguedad_maxima 
                        ? `${v.antiguedad_minima} - ${v.antiguedad_maxima} a√±os`
                        : `M√°s de ${v.antiguedad_minima} a√±os`;
                    
                    html += `
                        <tr>
                            <td><strong>${rango}</strong></td>
                            <td>${v.dias_base} d√≠as</td>
                            <td>${v.dias_adicionales || 0} d√≠as</td>
                            <td><strong>${v.dias_base + (v.dias_adicionales || 0)} d√≠as</strong></td>
                            <td>${v.descripcion || '-'}</td>
                            <td>
                                <button class="btn btn-edit" onclick="editarVacacion(${v.id})">Editar</button>
                                <button class="btn btn-danger" style="padding: 8px 16px; font-size: 12px;" onclick="eliminarVacacion(${v.id})">Eliminar</button>
                            </td>
                        </tr>
                    `;
                });
                
                html += '</tbody></table>';
                container.innerHTML = html;
            } catch (error) {
                container.innerHTML = '<div class="alert alert-error">Error al cargar pol√≠ticas de vacaciones</div>';
                console.error('Error:', error);
            }
        }

        document.getElementById('vacacion-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const id = document.getElementById('vacacion-id').value;
            const data = {
                antiguedad_minima: parseInt(document.getElementById('vacacion-antiguedad-min').value),
                antiguedad_maxima: document.getElementById('vacacion-antiguedad-max').value ? parseInt(document.getElementById('vacacion-antiguedad-max').value) : null,
                dias_base: parseInt(document.getElementById('vacacion-dias-base').value),
                dias_adicionales: parseInt(document.getElementById('vacacion-dias-adicionales').value) || 0,
                descripcion: document.getElementById('vacacion-descripcion').value
            };

            try {
                const url = id ? `${API_URL}/politicas-vacaciones/${id}` : `${API_URL}/politicas-vacaciones`;
                const method = id ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    this.reset();
                    document.getElementById('vacacion-id').value = '';
                    document.getElementById('vacacion-cancelar').style.display = 'none';
                    document.getElementById('vacacion-form-title').textContent = 'Agregar Pol√≠tica de Vacaciones';
                    cargarVacaciones();
                    alert(id ? 'Pol√≠tica de vacaciones actualizada' : 'Pol√≠tica de vacaciones creada');
                }
            } catch (error) {
                alert('Error al guardar pol√≠tica de vacaciones');
                console.error('Error:', error);
            }
        });

        async function editarVacacion(id) {
            try {
                const response = await fetch(`${API_URL}/politicas-vacaciones/${id}`);
                const vacacion = await response.json();
                
                document.getElementById('vacacion-id').value = vacacion.id;
                document.getElementById('vacacion-antiguedad-min').value = vacacion.antiguedad_minima;
                document.getElementById('vacacion-antiguedad-max').value = vacacion.antiguedad_maxima || '';
                document.getElementById('vacacion-dias-base').value = vacacion.dias_base;
                document.getElementById('vacacion-dias-adicionales').value = vacacion.dias_adicionales || '';
                document.getElementById('vacacion-descripcion').value = vacacion.descripcion || '';
                document.getElementById('vacacion-cancelar').style.display = 'inline-block';
                document.getElementById('vacacion-form-title').textContent = 'Editar Pol√≠tica de Vacaciones';
                window.scrollTo(0, 0);
            } catch (error) {
                alert('Error al cargar pol√≠tica de vacaciones');
                console.error('Error:', error);
            }
        }

        async function eliminarVacacion(id) {
            if (!confirm('¬øEst√°s seguro de eliminar esta pol√≠tica de vacaciones?')) return;
            
            try {
                const response = await fetch(`${API_URL}/politicas-vacaciones/${id}`, { method: 'DELETE' });
                if (response.ok) {
                    cargarVacaciones();
                    alert('Pol√≠tica de vacaciones eliminada');
                }
            } catch (error) {
                alert('Error al eliminar pol√≠tica de vacaciones');
                console.error('Error:', error);
            }
        }

        // ============================================
        // LICENCIAS
        // ============================================

        async function cargarLicencias() {
            const container = document.getElementById('licencias-list');
            container.innerHTML = '<div class="loading">Cargando tipos de licencias...</div>';

            try {
                const response = await fetch(`${API_URL}/tipos-licencias`);
                const licencias = await response.json();

                if (licencias.length === 0) {
                    container.innerHTML = '<div class="empty-state"><p>No hay tipos de licencias configurados</p></div>';
                    return;
                }

                let html = '<table><thead><tr><th>Nombre</th><th>Goce de Sueldo</th><th>L√≠mite de D√≠as</th><th>Requiere Certificado</th><th>Descripci√≥n</th><th>Acciones</th></tr></thead><tbody>';
                
                licencias.forEach(l => {
                    html += `
                        <tr>
                            <td><strong>${l.nombre}</strong></td>
                            <td>${l.con_goce_sueldo ? 'S√≠' : 'No'}</td>
                            <td>${l.limite_dias ? l.limite_dias + ' d√≠as' : 'Sin l√≠mite'}</td>
                            <td>${l.requiere_certificado ? 'S√≠' : 'No'}</td>
                            <td>${l.descripcion || '-'}</td>
                            <td>
                                <button class="btn btn-edit" onclick="editarLicencia(${l.id})">Editar</button>
                                <button class="btn btn-danger" style="padding: 8px 16px; font-size: 12px;" onclick="eliminarLicencia(${l.id})">Eliminar</button>
                            </td>
                        </tr>
                    `;
                });
                
                html += '</tbody></table>';
                container.innerHTML = html;
            } catch (error) {
                container.innerHTML = '<div class="alert alert-error">Error al cargar tipos de licencias</div>';
                console.error('Error:', error);
            }
        }

        document.getElementById('licencia-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const id = document.getElementById('licencia-id').value;
            const data = {
                nombre: document.getElementById('licencia-nombre').value,
                con_goce_sueldo: document.getElementById('licencia-con-goce').checked,
                limite_dias: document.getElementById('licencia-limite-dias').value ? parseInt(document.getElementById('licencia-limite-dias').value) : null,
                requiere_certificado: document.getElementById('licencia-requiere-certificado').checked,
                descripcion: document.getElementById('licencia-descripcion').value
            };

            try {
                const url = id ? `${API_URL}/tipos-licencias/${id}` : `${API_URL}/tipos-licencias`;
                const method = id ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    this.reset();
                    document.getElementById('licencia-id').value = '';
                    document.getElementById('licencia-cancelar').style.display = 'none';
                    document.getElementById('licencia-form-title').textContent = 'Agregar Tipo de Licencia';
                    cargarLicencias();
                    alert(id ? 'Tipo de licencia actualizado' : 'Tipo de licencia creado');
                }
            } catch (error) {
                alert('Error al guardar tipo de licencia');
                console.error('Error:', error);
            }
        });

        async function editarLicencia(id) {
            try {
                const response = await fetch(`${API_URL}/tipos-licencias/${id}`);
                const licencia = await response.json();
                
                document.getElementById('licencia-id').value = licencia.id;
                document.getElementById('licencia-nombre').value = licencia.nombre;
                document.getElementById('licencia-con-goce').checked = licencia.con_goce_sueldo;
                document.getElementById('licencia-limite-dias').value = licencia.limite_dias || '';
                document.getElementById('licencia-requiere-certificado').checked = licencia.requiere_certificado;
                document.getElementById('licencia-descripcion').value = licencia.descripcion || '';
                document.getElementById('licencia-cancelar').style.display = 'inline-block';
                document.getElementById('licencia-form-title').textContent = 'Editar Tipo de Licencia';
                window.scrollTo(0, 0);
            } catch (error) {
                alert('Error al cargar tipo de licencia');
                console.error('Error:', error);
            }
        }

        async function eliminarLicencia(id) {
            if (!confirm('¬øEst√°s seguro de eliminar este tipo de licencia?')) return;
            
            try {
                const response = await fetch(`${API_URL}/tipos-licencias/${id}`, { method: 'DELETE' });
                if (response.ok) {
                    cargarLicencias();
                    alert('Tipo de licencia eliminado');
                }
            } catch (error) {
                alert('Error al eliminar tipo de licencia');
                console.error('Error:', error);
            }
        }

        // ============================================
        // ASOCIACIONES
        // ============================================

        async function cargarDatosAsociaciones() {
            try {
                // Cargar convenios
                const responseConvenios = await fetch(`${API_URL}/convenios`);
                const convenios = await responseConvenios.json();
                
                const selectConvenio = document.getElementById('asociacion-convenio');
                const selectLicenciaConvenio = document.getElementById('asociacion-licencia-convenio');
                
                selectConvenio.innerHTML = '<option value="">Seleccionar convenio...</option>';
                selectLicenciaConvenio.innerHTML = '<option value="">Seleccionar convenio...</option>';
                
                convenios.forEach(c => {
                    selectConvenio.innerHTML += `<option value="${c.id}">${c.nombre}</option>`;
                    selectLicenciaConvenio.innerHTML += `<option value="${c.id}">${c.nombre}</option>`;
                });

                // Cargar descuentos
                const responseDescuentos = await fetch(`${API_URL}/descuentos`);
                const descuentos = await responseDescuentos.json();
                
                const selectDescuento = document.getElementById('asociacion-descuento');
                selectDescuento.innerHTML = '<option value="">Seleccionar descuento...</option>';
                
                descuentos.forEach(d => {
                    selectDescuento.innerHTML += `<option value="${d.id}">${d.nombre}</option>`;
                });

                // Cargar licencias
                const responseLicencias = await fetch(`${API_URL}/tipos-licencias`);
                const licencias = await responseLicencias.json();
                
                const selectLicencia = document.getElementById('asociacion-licencia');
                selectLicencia.innerHTML = '<option value="">Seleccionar licencia...</option>';
                
                licencias.forEach(l => {
                    selectLicencia.innerHTML += `<option value="${l.id}">${l.nombre}</option>`;
                });

            } catch (error) {
                console.error('Error al cargar datos para asociaciones:', error);
            }
        }

        async function asociarDescuento() {
            const convenioId = document.getElementById('asociacion-convenio').value;
            const descuentoId = document.getElementById('asociacion-descuento').value;
            const fechaDesde = document.getElementById('asociacion-fecha-desde').value;
            const fechaHasta = document.getElementById('asociacion-fecha-hasta').value;

            if (!convenioId || !descuentoId || !fechaDesde) {
                alert('Por favor complete todos los campos obligatorios');
                return;
            }

            try {
                const response = await fetch(`${API_URL}/convenios/${convenioId}/descuentos`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        descuento_id: descuentoId,
                        fecha_desde: fechaDesde,
                        fecha_hasta: fechaHasta || null
                    })
                });

                if (response.ok) {
                    alert('Descuento asociado al convenio exitosamente');
                    // Limpiar formulario
                    document.getElementById('asociacion-descuento').value = '';
                    document.getElementById('asociacion-fecha-desde').value = '';
                    document.getElementById('asociacion-fecha-hasta').value = '';
                } else {
                    const error = await response.json();
                    alert('Error: ' + error.error);
                }
            } catch (error) {
                alert('Error al asociar descuento');
                console.error('Error:', error);
            }
        }

        async function asociarLicencia() {
            const convenioId = document.getElementById('asociacion-licencia-convenio').value;
            const licenciaId = document.getElementById('asociacion-licencia').value;

            if (!convenioId || !licenciaId) {
                alert('Por favor seleccione un convenio y una licencia');
                return;
            }

            try {
                const response = await fetch(`${API_URL}/convenios/${convenioId}/licencias`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        licencia_id: licenciaId
                    })
                });

                if (response.ok) {
                    alert('Licencia asociada al convenio exitosamente');
                    // Limpiar formulario
                    document.getElementById('asociacion-licencia').value = '';
                } else {
                    const error = await response.json();
                    alert('Error: ' + error.error);
                }
            } catch (error) {
                alert('Error al asociar licencia');
                console.error('Error:', error);
            }
        }

        // ============================================
        // FUNCIONES AUXILIARES
        // ============================================
        
        function cancelarEdicion(tipo) {
            document.getElementById(`${tipo}-form`).reset();
            document.getElementById(`${tipo}-id`).value = '';
            document.getElementById(`${tipo}-cancelar`).style.display = 'none';
            document.getElementById(`${tipo}-form-title`).textContent = 
                tipo === 'convenio' ? 'Agregar Nuevo Convenio' :
                tipo === 'hora' ? 'Agregar Tipo de Hora Extra' :
                tipo === 'feriado' ? 'Agregar Feriado' :
                tipo === 'adicional' ? 'Agregar Adicional' :
                tipo === 'descuento' ? 'Agregar Descuento' :
                tipo === 'vacacion' ? 'Agregar Pol√≠tica de Vacaciones' :
                'Agregar Tipo de Licencia';
        }

        // ============================================
        // INICIALIZACI√ìN
        // ============================================
        
        // Cargar datos al iniciar
        window.addEventListener('DOMContentLoaded', function() {
            verificarConexion();
            cargarConvenios();
            cargarHorasExtras();
            cargarFeriados();
            cargarAdicionales();
            cargarDescuentos();
            cargarVacaciones();
            cargarLicencias();
            cargarDatosAsociaciones();
        });



        




////////////////////////////////////////////////////////////// 
// ENTREGA NRO 3: L√ìGICA DE C√ÅLCULO PARA EMPLEADO DE PRUEBA //
//////////////////////////////////////////////////////////////

// ============================================
// EMPLEADOS
// ============================================

        async function cargarEmpleados() {
            const container = document.getElementById('empleados-list');
            container.innerHTML = '<div class="loading">Cargando empleados...</div>';

            try {
                const response = await fetch(`${API_URL}/empleados`);
                const empleados = await response.json();

                if (empleados.length === 0) {
                    container.innerHTML = '<div class="empty-state"><p>No hay empleados registrados</p></div>';
                    return;
                }

                let html = '<table><thead><tr><th>Legajo</th><th>Nombre</th><th>DNI</th><th>Salario Base</th><th>Convenio</th><th>Acciones</th></tr></thead><tbody>';
                
                empleados.forEach(e => {
                    html += `
                        <tr>
                            <td><strong>${e.legajo}</strong></td>
                            <td>${e.apellido}, ${e.nombre}</td>
                            <td>${e.dni}</td>
                            <td>$${parseFloat(e.salario_base).toLocaleString('es-AR', {minimumFractionDigits: 2})}</td>
                            <td>${e.convenio_nombre || 'Sin convenio'}</td>
                            <td>
                                <button class="btn btn-edit" onclick="editarEmpleado(${e.id})">Editar</button>
                                <button class="btn btn-danger" style="padding: 8px 16px; font-size: 12px;" onclick="eliminarEmpleado(${e.id})">Eliminar</button>
                            </td>
                        </tr>
                    `;
                });
                
                html += '</tbody></table>';
                container.innerHTML = html;
                showOperationResult('load', true, 'Empleados cargados correctamente');
            } catch (error) {
                container.innerHTML = '<div class="alert alert-error">Error al cargar empleados</div>';
                console.error('Error:', error);
                showOperationResult('load', false, 'Error al cargar empleados');
            }
        }

        async function cargarDatosFormularios() {
            try {
                const response = await fetch(`${API_URL}/datos-formularios`);
                const datos = await response.json();

                // Cargar convenios en formulario de empleados
                const selectConvenio = document.getElementById('empleado-convenio');
                selectConvenio.innerHTML = '<option value="">Seleccionar convenio...</option>';
                datos.convenios.forEach(c => {
                    selectConvenio.innerHTML += `<option value="${c.id}">${c.nombre}</option>`;
                });

                // Cargar empleados para liquidaci√≥n
                const selectLiquidacionEmpleado = document.getElementById('liquidacion-empleado');
                selectLiquidacionEmpleado.innerHTML = '<option value="">Seleccionar empleado...</option>';
                const empleados = await fetch(`${API_URL}/empleados`).then(r => r.json());
                empleados.forEach(e => {
                    selectLiquidacionEmpleado.innerHTML += `<option value="${e.id}">${e.legajo} - ${e.apellido}, ${e.nombre}</option>`;
                });

                // Cargar tipos de horas extras
                const selectHoraExtra = document.getElementById('hora-extra-tipo');
                selectHoraExtra.innerHTML = '<option value="">Seleccionar tipo...</option>';
                datos.horasExtras.forEach(h => {
                    selectHoraExtra.innerHTML += `<option value="${h.id}">${h.nombre} (${h.multiplicador}x)</option>`;
                });

                // Cargar adicionales
                const selectAdicional = document.getElementById('adicional-empleado-tipo');
                selectAdicional.innerHTML = '<option value="">Seleccionar adicional...</option>';
                datos.adicionales.forEach(a => {
                    selectAdicional.innerHTML += `<option value="${a.id}">${a.nombre}</option>`;
                });

                // Cargar descuentos
                const selectDescuento = document.getElementById('descuento-empleado-tipo');
                selectDescuento.innerHTML = '<option value="">Seleccionar descuento...</option>';
                datos.descuentos.forEach(d => {
                    selectDescuento.innerHTML += `<option value="${d.id}">${d.nombre}</option>`;
                });

            } catch (error) {
                console.error('Error al cargar datos para formularios:', error);
            }
        }

        document.getElementById('empleado-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const id = document.getElementById('empleado-id').value;
            const data = {
                legajo: document.getElementById('empleado-legajo').value,
                nombre: document.getElementById('empleado-nombre').value,
                apellido: document.getElementById('empleado-apellido').value,
                dni: document.getElementById('empleado-dni').value,
                fecha_nacimiento: document.getElementById('empleado-fecha-nacimiento').value || null,
                fecha_ingreso: document.getElementById('empleado-fecha-ingreso').value,
                email: document.getElementById('empleado-email').value || null,
                telefono: document.getElementById('empleado-telefono').value || null,
                direccion: document.getElementById('empleado-direccion').value || null,
                salario_base: parseFloat(document.getElementById('empleado-salario-base').value),
                convenio_id: document.getElementById('empleado-convenio').value || null
            };

            try {
                const url = id ? `${API_URL}/empleados/${id}` : `${API_URL}/empleados`;
                const method = id ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    this.reset();
                    document.getElementById('empleado-id').value = '';
                    document.getElementById('empleado-cancelar').style.display = 'none';
                    document.getElementById('empleado-form-title').textContent = 'Agregar Nuevo Empleado';
                    cargarEmpleados();
                    cargarDatosFormularios(); // Recargar lista de empleados para liquidaci√≥n
                    showOperationResult(id ? 'update' : 'create', true);
                } else {
                    const error = await response.json();
                    showOperationResult(id ? 'update' : 'create', false, error.error);
                }
            } catch (error) {
                showOperationResult(id ? 'update' : 'create', false, 'Error de conexi√≥n al servidor');
            }
        });

        async function editarEmpleado(id) {
            try {
                const response = await fetch(`${API_URL}/empleados/${id}`);
                const empleado = await response.json();
                
                document.getElementById('empleado-id').value = empleado.id;
                document.getElementById('empleado-legajo').value = empleado.legajo;
                document.getElementById('empleado-nombre').value = empleado.nombre;
                document.getElementById('empleado-apellido').value = empleado.apellido;
                document.getElementById('empleado-dni').value = empleado.dni;
                document.getElementById('empleado-fecha-nacimiento').value = empleado.fecha_nacimiento || '';
                document.getElementById('empleado-fecha-ingreso').value = empleado.fecha_ingreso;
                document.getElementById('empleado-email').value = empleado.email || '';
                document.getElementById('empleado-telefono').value = empleado.telefono || '';
                document.getElementById('empleado-direccion').value = empleado.direccion || '';
                document.getElementById('empleado-salario-base').value = empleado.salario_base;
                document.getElementById('empleado-convenio').value = empleado.convenio_id || '';
                
                document.getElementById('empleado-cancelar').style.display = 'inline-block';
                document.getElementById('empleado-form-title').textContent = 'Editar Empleado';
                window.scrollTo(0, 0);
                showNotification('info', 'Modo Edici√≥n', 'Editando empleado: ' + empleado.nombre + ' ' + empleado.apellido);
            } catch (error) {
                alert('Error al cargar empleado para editar');
                console.error('Error:', error);
            }
        }

        async function eliminarEmpleado(id) {
            if (!confirm('¬øEst√°s seguro de eliminar este empleado?')) return;
            
            try {
                const response = await fetch(`${API_URL}/empleados/${id}`, { method: 'DELETE' });
                if (response.ok) {
                    cargarEmpleados();
                    cargarDatosFormularios(); // Recargar lista de empleados para liquidaci√≥n
                    showOperationResult('delete', true);
                }
            } catch (error) {
                alert('Error al eliminar empleado');
                console.error('Error:', error);
            }
        }

        // ============================================
        // C√ÅLCULO DE LIQUIDACIONES
        // ============================================

        async function calcularLiquidacion() {
            const empleadoId = document.getElementById('liquidacion-empleado').value;
            const periodo = document.getElementById('liquidacion-periodo').value;

            if (!empleadoId || !periodo) {
                showNotification('error', 'Error', 'Por favor seleccione un empleado y un per√≠odo');
                return;
            }

            try {
                const response = await fetch(`${API_URL}/empleados/${empleadoId}/calcular-liquidacion`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ periodo: periodo })
                });

                if (response.ok) {
                    const liquidacion = await response.json();
                    mostrarResultadoLiquidacion(liquidacion);
                    
                    // Mostrar bot√≥n para guardar
                    document.getElementById('btn-guardar-liquidacion').style.display = 'inline-block';
                    document.getElementById('btn-guardar-liquidacion').onclick = () => guardarLiquidacion(empleadoId, periodo);
                    
                } else {
                    const error = await response.json();
                    showNotification('error', 'Error', error.error);
                }
            } catch (error) {
                showNotification('error', 'Error', 'Error al calcular liquidaci√≥n');
                console.error('Error:', error);
            }
        }

        function mostrarResultadoLiquidacion(liquidacion) {
            const container = document.getElementById('detalle-liquidacion');
            
            let html = `
                <div style="margin-bottom: 20px;">
                    <h4>Empleado: ${liquidacion.empleado.apellido}, ${liquidacion.empleado.nombre}</h4>
                    <p><strong>Legajo:</strong> ${liquidacion.empleado.legajo} | <strong>Per√≠odo:</strong> ${liquidacion.periodo}</p>
                </div>

                <div class="form-row">
                    <div class="form-container">
                        <h4 style="color: #28a745;">üíµ Haberes</h4>
                        <table style="width: 100%;">
                            <tr>
                                <td>Salario Base:</td>
                                <td style="text-align: right;">$${liquidacion.haberes.salario_base.toLocaleString('es-AR', {minimumFractionDigits: 2})}</td>
                            </tr>
                            <tr>
                                <td>Horas Extras:</td>
                                <td style="text-align: right;">$${liquidacion.haberes.horas_extras.toLocaleString('es-AR', {minimumFractionDigits: 2})}</td>
                            </tr>
                            <tr>
                                <td>Adicionales:</td>
                                <td style="text-align: right;">$${liquidacion.haberes.adicionales.toLocaleString('es-AR', {minimumFractionDigits: 2})}</td>
                            </tr>
                            <tr style="border-top: 2px solid #ddd; font-weight: bold;">
                                <td>Total Haberes:</td>
                                <td style="text-align: right;">$${liquidacion.haberes.total.toLocaleString('es-AR', {minimumFractionDigits: 2})}</td>
                            </tr>
                        </table>
                    </div>

                    <div class="form-container">
                        <h4 style="color: #dc3545;">üìâ Descuentos</h4>
                        <table style="width: 100%;">
            `;
            
            liquidacion.descuentos.detalle.forEach(desc => {
                html += `
                    <tr>
                        <td>${desc.concepto}:</td>
                        <td style="text-align: right;">$${desc.monto.toLocaleString('es-AR', {minimumFractionDigits: 2})}</td>
                    </tr>
                `;
            });
            
            html += `
                            <tr style="border-top: 2px solid #ddd; font-weight: bold;">
                                <td>Total Descuentos:</td>
                                <td style="text-align: right;">$${liquidacion.descuentos.total.toLocaleString('es-AR', {minimumFractionDigits: 2})}</td>
                            </tr>
                        </table>
                    </div>
                </div>

                <div class="form-container" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    <h3 style="color: white; text-align: center;">
                        Neto a Pagar: $${liquidacion.neto_a_pagar.toLocaleString('es-AR', {minimumFractionDigits: 2})}
                    </h3>
                </div>
            `;
            
            container.innerHTML = html;
            document.getElementById('resultado-liquidacion').style.display = 'block';
            
            // Configurar formularios de conceptos
            document.getElementById('hora-extra-empleado-id').value = liquidacion.empleado.id;
            document.getElementById('adicional-empleado-id').value = liquidacion.empleado.id;
            document.getElementById('descuento-empleado-id').value = liquidacion.empleado.id;
            
            // Establecer fecha actual en formularios
            const hoy = new Date().toISOString().split('T')[0];
            document.getElementById('hora-extra-fecha').value = hoy;
            document.getElementById('adicional-empleado-fecha').value = hoy;
            document.getElementById('descuento-empleado-fecha').value = hoy;
        }

        async function guardarLiquidacion(empleadoId, periodo) {
            try {
                const response = await fetch(`${API_URL}/empleados/${empleadoId}/liquidaciones`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ periodo: periodo })
                });

                if (response.ok) {
                    showNotification('success', 'Liquidaci√≥n Guardada', 'La liquidaci√≥n se guard√≥ correctamente en el historial');
                    document.getElementById('btn-guardar-liquidacion').style.display = 'none';
                } else {
                    const error = await response.json();
                    showNotification('error', 'Error', error.error);
                }
            } catch (error) {
                showNotification('error', 'Error', 'Error al guardar liquidaci√≥n');
                console.error('Error:', error);
            }
        }

        // Formularios para agregar conceptos
        document.getElementById('hora-extra-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const empleadoId = document.getElementById('hora-extra-empleado-id').value;
            const data = {
                tipo_hora_extra_id: document.getElementById('hora-extra-tipo').value,
                cantidad: parseFloat(document.getElementById('hora-extra-cantidad').value),
                fecha: document.getElementById('hora-extra-fecha').value,
                descripcion: document.getElementById('hora-extra-descripcion').value
            };

            if (!empleadoId) {
                showNotification('error', 'Error', 'Primero calcule una liquidaci√≥n para un empleado');
                return;
            }

            try {
                const response = await fetch(`${API_URL}/empleados/${empleadoId}/horas-extras`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    this.reset();
                    document.getElementById('hora-extra-fecha').value = new Date().toISOString().split('T')[0];
                    showNotification('success', 'Hora Extra Agregada', 'La hora extra se registr√≥ correctamente');
                } else {
                    const error = await response.json();
                    showNotification('error', 'Error', error.error);
                }
            } catch (error) {
                showNotification('error', 'Error', 'Error al registrar hora extra');
                console.error('Error:', error);
            }
        });

        document.getElementById('adicional-empleado-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const empleadoId = document.getElementById('adicional-empleado-id').value;
            const data = {
                adicional_id: document.getElementById('adicional-empleado-tipo').value,
                monto: parseFloat(document.getElementById('adicional-empleado-monto').value),
                fecha: document.getElementById('adicional-empleado-fecha').value,
                descripcion: document.getElementById('adicional-empleado-descripcion').value
            };

            if (!empleadoId) {
                showNotification('error', 'Error', 'Primero calcule una liquidaci√≥n para un empleado');
                return;
            }

            try {
                const response = await fetch(`${API_URL}/empleados/${empleadoId}/adicionales`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    this.reset();
                    document.getElementById('adicional-empleado-fecha').value = new Date().toISOString().split('T')[0];
                    showNotification('success', 'Adicional Agregado', 'El adicional se registr√≥ correctamente');
                } else {
                    const error = await response.json();
                    showNotification('error', 'Error', error.error);
                }
            } catch (error) {
                showNotification('error', 'Error', 'Error al registrar adicional');
                console.error('Error:', error);
            }
        });

        document.getElementById('descuento-empleado-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const empleadoId = document.getElementById('descuento-empleado-id').value;
            const data = {
                descuento_id: document.getElementById('descuento-empleado-tipo').value,
                monto: parseFloat(document.getElementById('descuento-empleado-monto').value),
                fecha: document.getElementById('descuento-empleado-fecha').value,
                descripcion: document.getElementById('descuento-empleado-descripcion').value
            };

            if (!empleadoId) {
                showNotification('error', 'Error', 'Primero calcule una liquidaci√≥n para un empleado');
                return;
            }

            try {
                const response = await fetch(`${API_URL}/empleados/${empleadoId}/descuentos`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    this.reset();
                    document.getElementById('descuento-empleado-fecha').value = new Date().toISOString().split('T')[0];
                    showNotification('success', 'Descuento Agregado', 'El descuento se registr√≥ correctamente');
                } else {
                    const error = await response.json();
                    showNotification('error', 'Error', error.error);
                }
            } catch (error) {
                showNotification('error', 'Error', 'Error al registrar descuento');
                console.error('Error:', error);
            }
        });

        // Actualizar la funci√≥n de cancelar edici√≥n
        function cancelarEdicion(tipo) {
            if (tipo === 'empleado') {
                document.getElementById('empleado-form').reset();
                document.getElementById('empleado-id').value = '';
                document.getElementById('empleado-cancelar').style.display = 'none';
                document.getElementById('empleado-form-title').textContent = 'Agregar Nuevo Empleado';
            } else {
                // ... resto del c√≥digo existente para otros tipos
                document.getElementById(`${tipo}-form`).reset();
                document.getElementById(`${tipo}-id`).value = '';
                document.getElementById(`${tipo}-cancelar`).style.display = 'none';
                document.getElementById(`${tipo}-form-title`).textContent = 
                    tipo === 'convenio' ? 'Agregar Nuevo Convenio' :
                    tipo === 'hora' ? 'Agregar Tipo de Hora Extra' :
                    tipo === 'feriado' ? 'Agregar Feriado' :
                    tipo === 'adicional' ? 'Agregar Adicional' :
                    tipo === 'descuento' ? 'Agregar Descuento' :
                    tipo === 'vacacion' ? 'Agregar Pol√≠tica de Vacaciones' :
                    'Agregar Tipo de Licencia';
            }
        }

        // Actualizar la inicializaci√≥n
        window.addEventListener('DOMContentLoaded', function() {
            verificarConexion();
            cargarConvenios();
            cargarHorasExtras();
            cargarFeriados();
            cargarAdicionales();
            cargarDescuentos();
            cargarVacaciones();
            cargarLicencias();
            cargarDatosAsociaciones();
            cargarEmpleados();
            cargarDatosFormularios();
            
            // Establecer per√≠odo actual por defecto
            const hoy = new Date();
            const periodo = hoy.toISOString().substring(0, 7);
            document.getElementById('liquidacion-periodo').value = periodo;
        });



        // ===================================================================== //
        // CUARTA ENTREGA: GENERACI√ìN DE RECIBOS Y REPORTES DE N√ìMINA           //
        // ===================================================================== //

        // Variables globales para almacenar datos temporales
        let reciboActual = null;
        let reporteNominaActual = null;

        // ============================================
        // GENERACI√ìN DE RECIBOS INDIVIDUALES
        // ============================================

        async function generarRecibo() {
            const empleadoId = document.getElementById('recibo-empleado').value;
            const periodo = document.getElementById('recibo-periodo').value;

            if (!empleadoId || !periodo) {
                showNotification('error', 'Error', 'Por favor seleccione un empleado y un per√≠odo');
                return;
            }

            try {
                const response = await fetch(`${API_URL}/recibos/${empleadoId}/${periodo}`);
                
                if (response.ok) {
                    reciboActual = await response.json();
                    mostrarVistaPreviaRecibo(reciboActual);
                    
                    // Mostrar botones de acci√≥n
                    document.getElementById('btn-imprimir-recibo').style.display = 'inline-block';
                    document.getElementById('btn-descargar-recibo').style.display = 'inline-block';
                    
                } else {
                    const error = await response.json();
                    showNotification('error', 'Error', error.error);
                }
            } catch (error) {
                showNotification('error', 'Error', 'Error al generar recibo');
                console.error('Error:', error);
            }
        }

        function mostrarVistaPreviaRecibo(recibo) {
            const container = document.getElementById('contenido-recibo');
            
            const fecha = new Date();
            const fechaEmision = fecha.toLocaleDateString('es-AR');
            
            let html = `
                <div class="recibo-container">
                    <div class="recibo-header">
                        <div class="recibo-empresa">EMPRESA EJEMPLO S.A.</div>
                        <div class="recibo-titulo">RECIBO DE SUELDO</div>
                        <div>Raz√≥n Social: Empresa Ejemplo S.A. - CUIT: 30-12345678-9</div>
                    </div>
                    
                    <div class="recibo-info">
                        <div>
                            <div class="recibo-info-item"><strong>Empleado:</strong> ${recibo.empleado.apellido}, ${recibo.empleado.nombre}</div>
                            <div class="recibo-info-item"><strong>Legajo:</strong> ${recibo.empleado.legajo}</div>
                            <div class="recibo-info-item"><strong>DNI:</strong> ${recibo.empleado.dni}</div>
                        </div>
                        <div>
                            <div class="recibo-info-item"><strong>Per√≠odo:</strong> ${recibo.periodo}</div>
                            <div class="recibo-info-item"><strong>Fecha de Emisi√≥n:</strong> ${fechaEmision}</div>
                            <div class="recibo-info-item"><strong>Convenio:</strong> ${recibo.empleado.convenio || 'No especificado'}</div>
                        </div>
                    </div>
                    
                    <table class="recibo-tabla">
                        <thead>
                            <tr>
                                <th colspan="2" style="background: #667eea; color: white;">HABERES</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Salario B√°sico</td>
                                <td style="text-align: right;">$${recibo.haberes.salario_base.toLocaleString('es-AR', {minimumFractionDigits: 2})}</td>
                            </tr>
                            <tr>
                                <td>Horas Extras</td>
                                <td style="text-align: right;">$${recibo.haberes.horas_extras.toLocaleString('es-AR', {minimumFractionDigits: 2})}</td>
                            </tr>
                            <tr>
                                <td>Adicionales</td>
                                <td style="text-align: right;">$${recibo.haberes.adicionales.toLocaleString('es-AR', {minimumFractionDigits: 2})}</td>
                            </tr>
                            <tr class="recibo-total">
                                <td><strong>TOTAL HABERES</strong></td>
                                <td style="text-align: right;"><strong>$${recibo.haberes.total.toLocaleString('es-AR', {minimumFractionDigits: 2})}</strong></td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <table class="recibo-tabla">
                        <thead>
                            <tr>
                                <th colspan="2" style="background: #dc3545; color: white;">DESCUENTOS</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            recibo.descuentos.detalle.forEach(desc => {
                html += `
                    <tr>
                        <td>${desc.concepto}</td>
                        <td style="text-align: right;">$${desc.monto.toLocaleString('es-AR', {minimumFractionDigits: 2})}</td>
                    </tr>
                `;
            });
            
            html += `
                            <tr class="recibo-total">
                                <td><strong>TOTAL DESCUENTOS</strong></td>
                                <td style="text-align: right;"><strong>$${recibo.descuentos.total.toLocaleString('es-AR', {minimumFractionDigits: 2})}</strong></td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div style="text-align: center; margin: 20px 0;">
                        <div style="font-size: 18px; font-weight: bold; color: #28a745;">
                            NETO A PAGAR: $${recibo.neto_a_pagar.toLocaleString('es-AR', {minimumFractionDigits: 2})}
                        </div>
                    </div>
                    
                    <div class="recibo-footer">
                        <div>Recibo generado el ${fechaEmision} - Sistema de Liquidaci√≥n de Sueldos</div>
                        <div>Este es un documento no v√°lido como comprobante oficial</div>
                    </div>
                </div>
                
                <div class="btn-group no-print">
                    <button class="btn btn-success" onclick="imprimirRecibo()">üñ®Ô∏è Imprimir Recibo</button>
                    <button class="btn btn-excel" onclick="descargarReciboPDF()">üì• Descargar PDF</button>
                </div>
            `;
            
            container.innerHTML = html;
            document.getElementById('vista-previa-recibo').style.display = 'block';
            
            // Scroll a la vista previa
            document.getElementById('vista-previa-recibo').scrollIntoView({ behavior: 'smooth' });
        }

        function imprimirRecibo() {
            window.print();
        }


        // NUEVO: FUNCI√ìN PARA EXPORTAR UN RECIBO DE SUELDOS A PDF
        async function descargarReciboPDF() {
            if (!reciboActual) {
                showNotification('error', 'Error', 'No hay recibo para descargar');
                return;
            }

            try {
                // Verificar si las librer√≠as est√°n disponibles
                if (typeof jsPDF === 'undefined' || typeof html2canvas === 'undefined') {
                    showNotification('error', 'Error', 'Librer√≠as PDF no disponibles. Usando impresi√≥n...');
                    imprimirRecibo();
                    return;
                }

                showNotification('info', 'Generando PDF', 'Creando documento PDF...');

                // Capturar el contenido del recibo
                const element = document.getElementById('contenido-recibo');
                const canvas = await html2canvas(element, {
                    scale: 2, // Mejor calidad
                    useCORS: true,
                    logging: false,
                    backgroundColor: '#ffffff'
                });

                // Crear PDF
                const pdf = new jsPDF.jsPDF('p', 'mm', 'a4');
                const imgData = canvas.toDataURL('image/png');
                
                // Calcular dimensiones para que quepa en A4
                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pdfHeight = (canvas.height * pdfWidth) / canvas.width;
                
                // Agregar imagen al PDF
                pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
                
                // Generar nombre del archivo
                const fileName = `recibo_${reciboActual.empleado.legajo}_${reciboActual.periodo}.pdf`;
                
                // Descargar PDF
                pdf.save(fileName);
                
                showNotification('success', 'PDF Descargado', 'Recibo guardado como: ' + fileName);
                
            } catch (error) {
                console.error('Error generando PDF:', error);
                showNotification('error', 'Error', 'No se pudo generar el PDF. Usando impresi√≥n...');
                // Fallback a impresi√≥n
                imprimirRecibo();
            }
        }

        // ============================================
        // REPORTES DE N√ìMINA
        // ============================================

        function toggleSeleccionEmpleados() {
            const tipoReporte = document.getElementById('tipo-reporte').value;
            const selectorEmpleados = document.getElementById('selector-empleados');
            
            if (tipoReporte === 'seleccionados') {
                selectorEmpleados.style.display = 'block';
                cargarListaEmpleadosCheckbox();
            } else {
                selectorEmpleados.style.display = 'none';
            }
        }

        async function cargarListaEmpleadosCheckbox() {
            try {
                const response = await fetch(`${API_URL}/empleados`);
                const empleados = await response.json();
                
                const container = document.getElementById('lista-empleados-checkbox');
                container.innerHTML = '';
                
                empleados.forEach(empleado => {
                    const checkbox = document.createElement('div');
                    checkbox.className = 'empleado-checkbox';
                    checkbox.innerHTML = `
                        <input type="checkbox" id="emp-${empleado.id}" value="${empleado.id}">
                        <label for="emp-${empleado.id}">${empleado.legajo} - ${empleado.apellido}, ${empleado.nombre}</label>
                    `;
                    container.appendChild(checkbox);
                });
                
            } catch (error) {
                console.error('Error al cargar lista de empleados:', error);
                showNotification('error', 'Error', 'No se pudieron cargar los empleados');
            }
        }

        async function generarReporteNomina() {
            const periodo = document.getElementById('nomina-periodo').value;
            const tipoReporte = document.getElementById('tipo-reporte').value;

            if (!periodo) {
                showNotification('error', 'Error', 'Por favor seleccione un per√≠odo');
                return;
            }

            try {
                let url = `${API_URL}/nomina/${periodo}`;
                let options = { method: 'GET' };

                if (tipoReporte === 'seleccionados') {
                    const empleadosSeleccionados = obtenerEmpleadosSeleccionados();
                    
                    if (empleadosSeleccionados.length === 0) {
                        showNotification('error', 'Error', 'Por favor seleccione al menos un empleado');
                        return;
                    }
                    
                    url = `${API_URL}/nomina/${periodo}/empleados`;
                    options = {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ empleadosIds: empleadosSeleccionados })
                    };
                }

                const response = await fetch(url, options);
                
                if (response.ok) {
                    reporteNominaActual = await response.json();
                    mostrarReporteNomina(reporteNominaActual);
                    
                    // Mostrar bot√≥n de exportaci√≥n
                    document.getElementById('btn-exportar-excel').style.display = 'inline-block';
                    
                } else {
                    const error = await response.json();
                    showNotification('error', 'Error', error.error);
                }
            } catch (error) {
                showNotification('error', 'Error', 'Error al generar reporte de n√≥mina');
                console.error('Error:', error);
            }
        }

        function obtenerEmpleadosSeleccionados() {
            const checkboxes = document.querySelectorAll('#lista-empleados-checkbox input[type="checkbox"]:checked');
            const empleadosIds = Array.from(checkboxes).map(checkbox => parseInt(checkbox.value));
            return empleadosIds;
        }

        function mostrarReporteNomina(reporte) {
            const container = document.getElementById('detalle-nomina');
            
            let html = `
                <div class="reporte-resumen">
                    <h4 style="color: white; margin: 0 0 10px 0;">Resumen de N√≥mina</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
                        <div>
                            <strong>Per√≠odo:</strong><br>
                            ${reporte.periodo}
                        </div>
                        <div>
                            <strong>Total Empleados:</strong><br>
                            ${reporte.total_empleados}
                        </div>
                        <div>
                            <strong>Total N√≥mina:</strong><br>
                            $${reporte.total_nomina.toLocaleString('es-AR', {minimumFractionDigits: 2})}
                        </div>
                    </div>
                </div>
                
                <table class="recibo-tabla">
                    <thead>
                        <tr>
                            <th>Legajo</th>
                            <th>Empleado</th>
                            <th>DNI</th>
                            <th>Salario Base</th>
                            <th>Horas Extras</th>
                            <th>Adicionales</th>
                            <th>Total Haberes</th>
                            <th>Total Descuentos</th>
                            <th>Neto a Pagar</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            reporte.empleados.forEach(emp => {
                html += `
                    <tr>
                        <td>${emp.legajo}</td>
                        <td>${emp.nombre}</td>
                        <td>${emp.dni}</td>
                        <td style="text-align: right;">$${emp.salario_base.toLocaleString('es-AR', {minimumFractionDigits: 2})}</td>
                        <td style="text-align: right;">$${emp.horas_extras.toLocaleString('es-AR', {minimumFractionDigits: 2})}</td>
                        <td style="text-align: right;">$${emp.adicionales.toLocaleString('es-AR', {minimumFractionDigits: 2})}</td>
                        <td style="text-align: right;">$${emp.total_haberes.toLocaleString('es-AR', {minimumFractionDigits: 2})}</td>
                        <td style="text-align: right;">$${emp.total_descuentos.toLocaleString('es-AR', {minimumFractionDigits: 2})}</td>
                        <td style="text-align: right; font-weight: bold;">$${emp.neto_a_pagar.toLocaleString('es-AR', {minimumFractionDigits: 2})}</td>
                    </tr>
                `;
            });
            
            html += `
                    </tbody>
                    <tfoot>
                        <tr style="background: #f8f9fa; font-weight: bold;">
                            <td colspan="6" style="text-align: right;">TOTAL N√ìMINA:</td>
                            <td style="text-align: right;">$${reporte.empleados.reduce((sum, emp) => sum + emp.total_haberes, 0).toLocaleString('es-AR', {minimumFractionDigits: 2})}</td>
                            <td style="text-align: right;">$${reporte.empleados.reduce((sum, emp) => sum + emp.total_descuentos, 0).toLocaleString('es-AR', {minimumFractionDigits: 2})}</td>
                            <td style="text-align: right;">$${reporte.total_nomina.toLocaleString('es-AR', {minimumFractionDigits: 2})}</td>
                        </tr>
                    </tfoot>
                </table>
                
                <div class="btn-group no-print">
                    <button class="btn btn-excel" onclick="exportarExcel()">üìä Exportar a Excel</button>
                </div>
            `;
            
            container.innerHTML = html;
            document.getElementById('resultado-nomina').style.display = 'block';
            
            // Scroll al resultado
            document.getElementById('resultado-nomina').scrollIntoView({ behavior: 'smooth' });
        }


        // NUEVO: EXPORTAR INFORME DE NOMINA A EXCEL
        function exportarExcel() {
            if (!reporteNominaActual) {
                showNotification('error', 'Error', 'No hay reporte para exportar');
                return;
            }

            try {
                // Verificar si la librer√≠a est√° disponible
                if (typeof XLSX === 'undefined') {
                    showNotification('error', 'Error', 'Librer√≠a Excel no disponible');
                    return;
                }

                showNotification('info', 'Generando Excel', 'Creando archivo Excel...');

                // Crear libro de Excel
                const wb = XLSX.utils.book_new();
                
                // Preparar datos para la hoja principal
                const datos = reporteNominaActual.empleados.map(emp => ({
                    'Legajo': emp.legajo,
                    'Empleado': emp.nombre,
                    'DNI': emp.dni,
                    'Salario Base': emp.salario_base,
                    'Horas Extras': emp.horas_extras,
                    'Adicionales': emp.adicionales,
                    'Total Haberes': emp.total_haberes,
                    'Total Descuentos': emp.total_descuentos,
                    'Neto a Pagar': emp.neto_a_pagar
                }));

                // Agregar fila de totales
                datos.push({
                    'Legajo': 'TOTAL',
                    'Empleado': '',
                    'DNI': '',
                    'Salario Base': reporteNominaActual.empleados.reduce((sum, emp) => sum + emp.salario_base, 0),
                    'Horas Extras': reporteNominaActual.empleados.reduce((sum, emp) => sum + emp.horas_extras, 0),
                    'Adicionales': reporteNominaActual.empleados.reduce((sum, emp) => sum + emp.adicionales, 0),
                    'Total Haberes': reporteNominaActual.empleados.reduce((sum, emp) => sum + emp.total_haberes, 0),
                    'Total Descuentos': reporteNominaActual.empleados.reduce((sum, emp) => sum + emp.total_descuentos, 0),
                    'Neto a Pagar': reporteNominaActual.total_nomina
                });

                // Crear hoja de datos
                const ws = XLSX.utils.json_to_sheet(datos, { skipHeader: false });
                
                // Agregar estilo a los encabezados
                if (!ws['!cols']) ws['!cols'] = [];
                ws['!cols'] = [
                    { wch: 10 }, // Legajo
                    { wch: 25 }, // Empleado
                    { wch: 12 }, // DNI
                    { wch: 12 }, // Salario Base
                    { wch: 12 }, // Horas Extras
                    { wch: 12 }, // Adicionales
                    { wch: 12 }, // Total Haberes
                    { wch: 12 }, // Total Descuentos
                    { wch: 12 }  // Neto a Pagar
                ];
                
                // Agregar hoja al libro
                XLSX.utils.book_append_sheet(wb, ws, `Nomina_${reporteNominaActual.periodo}`);
                
                // Crear hoja de resumen
                const resumenData = [
                    ['RESUMEN DE N√ìMINA'],
                    [''],
                    ['Per√≠odo:', reporteNominaActual.periodo],
                    ['Total Empleados:', reporteNominaActual.total_empleados],
                    ['Total N√≥mina:', reporteNominaActual.total_nomina],
                    [''],
                    ['Fecha de Generaci√≥n:', new Date().toLocaleDateString('es-AR')]
                ];
                
                const wsResumen = XLSX.utils.aoa_to_sheet(resumenData);
                XLSX.utils.book_append_sheet(wb, wsResumen, 'Resumen');
                
                // Generar nombre del archivo
                const fileName = `nomina_${reporteNominaActual.periodo}.xlsx`;
                
                // Descargar archivo
                XLSX.writeFile(wb, fileName);
                
                showNotification('success', 'Excel Exportado', 'Reporte guardado como: ' + fileName);
                
            } catch (error) {
                console.error('Error exportando Excel:', error);
                showNotification('error', 'Error', 'No se pudo exportar a Excel');
            }
        }

        // ============================================
        // INICIALIZACI√ìN DE LA SECCI√ìN DE REPORTES
        // ============================================

        function inicializarSeccionReportes() {
            // Cargar empleados en el selector de recibos
            cargarEmpleadosParaRecibos();
            
            // Establecer per√≠odo actual por defecto
            const hoy = new Date();
            const periodo = hoy.toISOString().substring(0, 7);
            document.getElementById('recibo-periodo').value = periodo;
            document.getElementById('nomina-periodo').value = periodo;
        }

        async function cargarEmpleadosParaRecibos() {
            try {
                const response = await fetch(`${API_URL}/empleados`);
                const empleados = await response.json();
                
                const selectRecibo = document.getElementById('recibo-empleado');
                selectRecibo.innerHTML = '<option value="">Seleccionar empleado...</option>';
                
                empleados.forEach(e => {
                    selectRecibo.innerHTML += `<option value="${e.id}">${e.legajo} - ${e.apellido}, ${e.nombre}</option>`;
                });
                
            } catch (error) {
                console.error('Error al cargar empleados para recibos:', error);
            }
        }

        // Actualizar la inicializaci√≥n para incluir reportes
        window.addEventListener('DOMContentLoaded', function() {
            verificarConexion();
            cargarConvenios();
            cargarHorasExtras();
            cargarFeriados();
            cargarAdicionales();
            cargarDescuentos();
            cargarVacaciones();
            cargarLicencias();
            cargarDatosAsociaciones();
            cargarEmpleados();
            cargarDatosFormularios();
            inicializarSeccionReportes();
            
            // Establecer per√≠odo actual por defecto en liquidaciones
            const hoy = new Date();
            const periodo = hoy.toISOString().substring(0, 7);
            document.getElementById('liquidacion-periodo').value = periodo;
        });


    </script>
</body>
</html>